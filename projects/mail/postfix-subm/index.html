<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Postfix Submission Service | Vithurshan SELVARAJAH</title><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/fonts/css/all.min.css><link rel=stylesheet href=/css/header-num.css><link rel=stylesheet href=/css/fonts.css></head><body><nav><ul class=menu><li><a href=/>Home</a></li><li><a href=/notes/>Notebook</a></li><li><a href=/categories/>Categories</a></li><li><a href=/projects/>Projects</a></li><li><a href=/index.xml>RSS</a></li></ul><hr></nav><div class=article-meta><h1><span class=title>Postfix Submission Service</span></h1><div class=post-meta><span> Published on 16 Feb 2025</span>
<span class=seperator>.</span>
<span> Filed in <a href=/projects>Projects</a></span>
<span class=seperator>.</span>
<span> 488 words</span></div></div><main><p>End users should not use port 25 but rather the submission service on TCP port 587 (as described in RFC 4409). The idea is to use port 25 to transport emails through the Mail Transport Agent (MTA) from one server to server and port 587 to submit emails through the Mail Submission Agent (MSA) from a user to a mail server.</p><p>In order to enable the submission port, we need to edit the file <code class=verbatim>/etc/postfix/master.cf</code> where all Postfix services are declared. Edit this file and find the submission section which is commented out by default. Transform this section into the following. Basically, I removed the <code class=verbatim>#</code> character on all lines in this section and removed the lines with the <code class=verbatim>mua_*</code> variables:</p><div class="src src-text"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>submission inet n       -       y       -       -       smtpd
</span></span><span style=display:flex><span>  -o syslog_name=postfix/submission
</span></span><span style=display:flex><span>  -o smtpd_tls_security_level=encrypt
</span></span><span style=display:flex><span>  -o smtpd_sasl_auth_enable=yes
</span></span><span style=display:flex><span>  -o smtpd_tls_auth_only=yes
</span></span><span style=display:flex><span>  -o smtpd_reject_unlisted_recipient=no
</span></span><span style=display:flex><span>  -o smtpd_client_restrictions=
</span></span><span style=display:flex><span>  -o smtpd_helo_restrictions=
</span></span><span style=display:flex><span>  -o smtpd_sender_restrictions=
</span></span><span style=display:flex><span>  -o smtpd_relay_restrictions=
</span></span><span style=display:flex><span>  -o smtpd_recipient_restrictions=permit_sasl_authenticated,reject
</span></span><span style=display:flex><span>  -o milter_macro_daemon_name=ORIGINATING</span></span></code></pre></div></div><p><strong>CAREFUL: Make sure to start the first line in the first column and indent the following lines.</strong></p><ul><li><code class=verbatim>smtpd</code>: This service uses the <a href="Postfix SMTP Client and Server">smtpd daemon</a> which is the piece of software that responds if you open an SMTP connection on TCP port 25.</li><li><code class=verbatim>syslog_name</code>: In the /var/log/mail.log log file you will see the connections to the submission port as postfix/submission.</li><li><code class=verbatim>smtpd_tls_security_level</code>: Enforce encryption on port 587.</li><li><code class=verbatim>smtpd_sasl_auth_enable</code>: Enable authentication.</li><li><code class=verbatim>smtpd_tls_auth_only</code> Enforce encryption during authentication.</li><li><code class=verbatim>smtpd_reject_unlisted_recipient</code>: Allow sending emails to recipients outside of this mail server.</li><li><code class=verbatim>smtpd_*_restrictions</code>: Remove special restrictions.</li><li><code class=verbatim>smtpd_recipient_restrictions</code>: allow relaying if the sender was authenticated.</li><li><code class=verbatim>milter_macro_daemon_name</code>: Assigns a macro value (in this case, <code class=verbatim>ORIGINATING</code>) that can be passed to Milter applications (e.g., for spam and virus filtering) to indicate the specific context or phase of email handling. Setting this to <code class=verbatim>ORIGINATING</code> identifies the email as coming from a sender inside your network, typically an authenticated or authorized sender. This is often done to inform Milter applications that the email originates from a trusted internal source. It can help these filters apply specific rules or bypass some checks for outgoing mail, such as spam filtering, which might not be necessary for internal users.</li></ul><p>Restart the Postfix server:</p><div class="src src-shell"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>  systemctl restart postfix</span></span></code></pre></div></div><div id=outline-container-headline-1 class=outline-2><h2 id=headline-1>Test Submission Service</h2><div id=outline-text-headline-1 class=outline-text-2><p>Your users can now use the submission port to send email. They just use the port 587 in their mail clients instead of port 25. You will need to install the <code class=verbatim>libnet-ssleay-perl</code> package first to use TLS encryption in SWAKS:</p><div class="src src-shell"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>  sudo apt install -y libnet-ssleay-perl</span></span></code></pre></div></div><p>Send a mails on submission port 587:</p><div class="src src-shell"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>  swaks --server localhost --to user1@example1.com --port <span style=color:#ae81ff>587</span> -tls --auth-user user1@example1.com --auth-password SecurePass</span></span></code></pre></div></div><p><em>NOTE: What is Port 465 ? This TCP port belongs to the "submission over TLS" service. It is used for the submission service but expects an encrypted connection from the first byte. This port is hardly ever used so you don’t have to care about it. The submission service you just configured is also encrypted but uses the STARTTLS mechanism to switch to a TLS connection after the welcome message.</em></p></div></div></main><footer><hr>© <a href=https:www.atomicl.net>Vithurshan SELVARAJAH</a> 2022 – 2025 | <a href=https://github.com/BlackcatRs>Github</a> | <a href=https://www.linkedin.com/in/vithurshan-selvarajah/>LinkedIn</a></footer></body></html>