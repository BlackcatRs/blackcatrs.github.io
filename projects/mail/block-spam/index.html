<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Optional — Block Spam | Vithurshan SELVARAJAH</title><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/fonts/css/all.min.css><link rel=stylesheet href=/css/header-num.css><link rel=stylesheet href=/css/fonts.css></head><body><nav><ul class=menu><li><a href=/>Home</a></li><li><a href=/notes/>Notebook</a></li><li><a href=/categories/>Categories</a></li><li><a href=/projects/>Projects</a></li><li><a href=/index.xml>RSS</a></li></ul><hr></nav><div class=article-meta><h1><span class=title>Optional — Block Spam</span></h1><div class=post-meta><span> Published on 16 Feb 2025</span>
<span class=seperator>.</span>
<span> Filed in <a href=/projects>Projects</a></span>
<span class=seperator>.</span>
<span> 1760 words</span></div></div><main><div id=outline-container-headline-1 class=outline-2><h2 id=headline-1>Reject Invalid EHLO/HELO Hostname</h2><div id=outline-text-headline-1 class=outline-text-2><p>Some spammers don’t provide a valid <code class=verbatim>HELO/EHLO</code> hostname during SMTP communication. They can be non-fully qualified domain name, or a domain name doesn’t exist or only for an internal network. For example, a spammer using an Amazon EC2 instance to send spam is logged on my server as follows:</p><div class="src src-text"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Aug 16 04:21:13 email postfix/smtpd[7070]: connect from ec2-54-237-201-103.compute-1.amazonaws.com[54.237.201.103]
</span></span><span style=display:flex><span>Aug 16 04:21:13 email policyd-spf[7074]: prepend Received-SPF: None (mailfrom) identity=mailfrom; client-ip=54.237.201.103; helo=ip-172-30-0-149.ec2.internal; envelope-from=superdiem@carpaythe.tk; receiver=&lt;UNKNOWN&gt;</span></span></code></pre></div></div><p>As you can see, the HELO hostname is <code class=verbatim>ip-172-30-0-149.ec2.internal</code> , which is only valid in AWS internal network. It has no valid A record nor MX record.</p><p>To enable HELO/EHLO hostname restriction, edit Postfix main configuration file:</p><div class="src src-shell"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>  sudo nano /etc/postfix/main.cf</span></span></code></pre></div></div><p>Add the following lines to reject SMTP client that does not provide valid HELO/EHLO hostname:</p><div class="src src-text"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>smtpd_helo_required = yes
</span></span><span style=display:flex><span>smtpd_helo_restrictions =
</span></span><span style=display:flex><span>    permit_mynetworks
</span></span><span style=display:flex><span>    permit_sasl_authenticated
</span></span><span style=display:flex><span>    check_helo_access hash:/etc/postfix/helo_access
</span></span><span style=display:flex><span>    reject_invalid_helo_hostname
</span></span><span style=display:flex><span>    reject_non_fqdn_helo_hostname
</span></span><span style=display:flex><span>    reject_unknown_helo_hostname</span></span></code></pre></div></div><ul><li><code class=verbatim>permit_mynetworks</code>: Allow IPs defined in this directive</li><li><code class=verbatim>permit_sasl_authenticated</code>: Allow authenticated users.</li><li><code class=verbatim>check_helo_access</code>: Allow hostnames defined in this file.</li><li><code class=verbatim>reject_invalid_helo_hostname</code>: Reject clients who provide malformed HELO/EHLO hostname.</li><li><code class=verbatim>reject_non_fqdn_helo_hostname</code>: Reject non-fully qualified HELO/EHLO hostname.</li><li><code class=verbatim>reject_unknown_helo_hostname</code>: Reject email with HELO/EHLO hostname has neither DNS A record nor MX record.</li></ul><p>Now create the file <code class=verbatim>/etc/postfix/helo_access</code> to whitelist domains that do not use a valid hostname:</p><div class="src src-text"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>optimus-webapi-prod-2.localdomain      OK
</span></span><span style=display:flex><span>va-massmail-02.rakutenmarketing.com    OK</span></span></code></pre></div></div><p>Then run the following command to create the <code class=verbatim>/etc/postfix/helo_access.db</code> file:</p><div class="src src-shell"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>  sudo postmap /etc/postfix/helo_access</span></span></code></pre></div></div><p>Save and close the file. Then reload Postfix.</p><div class="src src-shell"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>  sudo systemctl reload postfix</span></span></code></pre></div></div></div></div><div id=outline-container-headline-2 class=outline-2><h2 id=headline-2>Reject Emails from Non-Valid Domains</h2><div id=outline-text-headline-2 class=outline-text-2><p>The <code class=verbatim>MAIL FROM</code> address is also known as <code class=verbatim>envelope from</code> address. Some spammers use a non-existent domain in the <code class=verbatim>MAIL FROM</code> address. If a domain name has no MX record, Postfix will find the A record of the main domain and send email to that host. If the sender domain has neither MX record nor A record, Postfix can’t send email to that domain. So reject those emails that you can’t reply to:</p><div class="src src-shell"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>  sudo nano /etc/postfix/main.cf</span></span></code></pre></div></div><p>Make the <code class=verbatim>smtpd_sender_restrictions</code> configuration directive look as follows:</p><div class="src src-text"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>smtpd_sender_restrictions =
</span></span><span style=display:flex><span>   permit_mynetworks
</span></span><span style=display:flex><span>   permit_sasl_authenticated
</span></span><span style=display:flex><span>   reject_unknown_sender_domain</span></span></code></pre></div></div><ul><li><code class=verbatim>reject_unknown_sender_domain</code>: Checks the sender's email domain in the <code class=verbatim>MAIL FROM</code> address to ensure it has a valid DNS configuration. It requires that the domain in the sender's email address has a valid MX or A record.</li></ul><p>Then restart Postfix for the change to take effect:</p><div class="src src-shell"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>  sudo systemctl restart postfix</span></span></code></pre></div></div></div></div><div id=outline-container-headline-3 class=outline-2><h2 id=headline-3>Reject Emails if No Valid PTR or A Record for Hostname</h2><div id=outline-text-headline-3 class=outline-text-2><p>A legitimate email server should have a PTR record and a valid A record for its hostname. The IP address returned from DNS A record should match the IP address of the contacting email server. So tell Postfix to perform these checks on SMTP client server:</p><div class="src src-shell"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>  sudo nano /etc/postfix/main.cf</span></span></code></pre></div></div><p>Make the <code class=verbatim>smtpd_sender_restrictions</code> configuration directive look as follows:</p><div class="src src-text"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>smtpd_sender_restrictions =
</span></span><span style=display:flex><span>   permit_mynetworks
</span></span><span style=display:flex><span>   permit_sasl_authenticated
</span></span><span style=display:flex><span>   reject_unknown_sender_domain
</span></span><span style=display:flex><span>   reject_unknown_reverse_client_hostname
</span></span><span style=display:flex><span>   reject_unknown_client_hostname</span></span></code></pre></div></div><ul><li><code class=verbatim>reject_unknown_reverse_client_hostname</code>: Checks the reverse DNS (PTR record) of the client’s IP address (the IP of the server connecting to your Postfix server) to ensures that the IP address of the sending server can be mapped back to a valid hostname.</li><li><code class=verbatim>reject_unknown_client_hostname</code>: Performs a check that the hostname obtained from the PTR record has a valid forward DNS (A record) pointing back to the SMTP server that connecting to your Postfix server.</li></ul><p>Save and close the file. Then restart Postfix for the change to take effect.</p><div class="src src-shell"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>  sudo systemctl restart postfix</span></span></code></pre></div></div></div></div><div id=outline-container-headline-4 class=outline-2><h2 id=headline-4>Greylisting</h2><div id=outline-text-headline-4 class=outline-text-2><div id=outline-container-headline-5 class=outline-3><h3 id=headline-5>Introduction</h3><div id=outline-text-headline-5 class=outline-text-3><p>Greylisting is a spam prevention technique that can be implemented in Postfix to reduce unwanted email by temporarily rejecting new email senders and requiring them to retry. Because most legitimate mail servers will retry delivery after a short delay, while many spam servers or bots will not attempt to resend.</p><p><strong>How Greylisting Works ?</strong></p><ol><li>Initial Rejection: When an email is received from an unfamiliar sender IP, sender address, and recipient address combination, Postfix temporarily rejects it with a <code class=verbatim>451</code> (Temporary failure) response. This tells the sending server to try again later.</li><li>Retry Attempt: If the sending server retries after a certain period, Postfix recognizes the retry as legitimate and accepts the email.</li><li>Temporary Listing: After accepting the email, Postfix remembers this sender-recipient combination for a configurable period, so subsequent emails from this source are accepted without delay.</li></ol></div></div><div id=outline-container-headline-6 class=outline-3><h3 id=headline-6>Configuration</h3><div id=outline-text-headline-6 class=outline-text-3><p>Postgrey is a greylisting policy server for Postfix. So first install install postgrey:</p><div class="src src-shell"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>  sudo apt install postgrey</span></span></code></pre></div></div><p>Start and enable it with systemctl:</p><div class="src src-shell"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>  sudo systemctl start postgrey
</span></span><span style=display:flex><span>  sudo systemctl enable postgrey</span></span></code></pre></div></div><p>On Debian and Ubuntu, it listens on TCP port 10023 on localhost:</p><div class="src src-shell"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>  sudo netstat -lnpt | grep postgrey</span></span></code></pre></div></div><p>Next, we need to edit Postfix main configuration file to make it use the greylisting policy server.</p><div class="src src-shell"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>  sudo nano /etc/postfix/main.cf</span></span></code></pre></div></div><p>Add the line <code class=verbatim>check_policy_service inet:127.0.0.1:10023</code> to <code class=verbatim>smtpd_recipient_restrictions</code> configuration directive:</p><div class="src src-text"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>smtpd_recipient_restrictions =
</span></span><span style=display:flex><span>   reject_unauth_destination,
</span></span><span style=display:flex><span>   check_policy_service unix:private/quota-status,
</span></span><span style=display:flex><span>   check_policy_service unix:private/policyd-spf,
</span></span><span style=display:flex><span>   check_policy_service inet:127.0.0.1:10023</span></span></code></pre></div></div><p>Then restart Postfix.</p><div class="src src-shell"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>  sudo systemctl restart postfix</span></span></code></pre></div></div><p>From now on, Postgrey will reject an email if the sender triplet (sender IP address, sender email address, recipient email address) is new. The following log message in <code class=verbatim>/var/log/mail.log</code> (or <code>sudo journalctl -u postgrey</code>) shows a new sender triplet. The action <code class=verbatim>greylist</code> means this email message was rejected:</p><div class="src src-text"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>postgrey[1016]: action=greylist, reason=new, client_name=unknown, client_address=117.90.24.148/32, sender=pnccepjeu@rhknqj.net, recipient=xiao@linuxbabe.com</span></span></code></pre></div></div></div></div><div id=outline-container-headline-7 class=outline-3><h3 id=headline-7>Whitelist Domains</h3><div id=outline-text-headline-7 class=outline-text-3><p>Greylisting can result in bad experience for the end user, as the user has to wait another several minute for the email to arrive. To minimize this bad experience, you can create a whitelist, and use a second MX record that points to the same host.
Whitelist</p><p>Postgrey ships with two whitelist files (<code class=verbatim>/etc/postgrey/whitelist_clients</code> and <code class=verbatim>/etc/postgrey/whitelist_recipients</code>). The former contains a list of hostnames and the latter contains a list of recipient addresses.</p><p>By default, Google’s mail servers are whitelisted. No matter the sender is using a <code class=verbatim>@gmail.com</code> address or other address, as long as the sender is using Google’s mail server, Postgrey won’t reject the email. The following line in my <code class=verbatim>/var/log/mail.log</code> file shows this:</p><div class="src src-text"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>postgrey[1032]: action=pass, reason=client whitelist, client_name=mail-yb0-f190.google.com</span></span></code></pre></div></div><p>You can add other hostnames in <code class=verbatim>/etc/postgrey/whitelist_clients</code> file, like:</p><div class="src src-shell"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>facebook.com
</span></span><span style=display:flex><span>bounce.twitter.com
</span></span><span style=display:flex><span>blogger.com
</span></span><span style=display:flex><span>email.medium.com</span></span></code></pre></div></div><p>Now let's create a secondary MX record in DNS with the same IP address pointing to your same Potfix server to allow the SMTP client to retry immediately after the first mail server rejects the mail. For example:</p><div class="src src-text"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Record Type    Name      Mail Server            Priority
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>MX             @         mail1.example1.com     0
</span></span><span style=display:flex><span>MX             @         mail2.example1.com     5</span></span></code></pre></div></div><p>The sender will try the first mail server (with priority 0). If <code class=verbatim>mail1.example1.com</code> rejects email by greylisting, then the sender would immediately try the second mail server (with priority 5).</p><p>Since two mail server hostnames have the same IP address, when the sender tries the second mail server hostname, the email will be accepted immediately (if all other checks pass) and end users will not notice the email delay caused by greylisting.</p><p>Note that this requires you to set a very small delay time like 1 second in <code class=verbatim>/etc/default/postgrey</code>. The delay time tells the SMTP client how many seconds to wait before sending again. If the delay time is not small enough, then the second email delivery would still be rejected:</p><div class="src src-text"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>POSTGREY_OPTS=&#34;--inet=127.0.0.1:10023 --delay=1&#34;</span></span></code></pre></div></div><p>Finally restart Postgrey:</p><div class="src src-shell"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>  sudo systemctl restart postgrey</span></span></code></pre></div></div></div></div><div id=outline-container-headline-8 class=outline-3><h3 id=headline-8>Troubleshooting</h3><div id=outline-text-headline-8 class=outline-text-3><p>If you see the following error in mail log (<code class=verbatim>/var/log/mail.log</code>)</p><div class="src src-text"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>warning: connect to 127.0.0.1:10023: Connection refused
</span></span><span style=display:flex><span>warning: problem talking to server 127.0.0.1:10023: Connection refused</span></span></code></pre></div></div><p>The problem is that postgrey is not running. You need to specify 127.0.0.1 as the listening address in /etc/default/postgrey file. So change the following line:</p><div class="src src-text"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>POSTGREY_OPTS=&#34;--inet=10023&#34;</span></span></code></pre></div></div><p>to</p><div class="src src-text"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>POSTGREY_OPTS=&#34;--inet=127.0.0.1:10023&#34;</span></span></code></pre></div></div><p>Then restart postgrey:</p><div class="src src-shell"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>  sudo systemctl restart postgrey</span></span></code></pre></div></div><p>Check if it’s listening:</p><div class="src src-text"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>  sudo netstat -lnpt | grep 10023</span></span></code></pre></div></div></div></div></div></div><div id=outline-container-headline-9 class=outline-2><h2 id=headline-9>Use Public Realtime Blacklists</h2><div id=outline-text-headline-9 class=outline-text-2><p>There are spam emails that are sent from servers that has a valid hostname, valid PTR record and can pass all previous checks. In this case, you can use blacklisting to reject spam. There are many public realtime blacklists (RBL), also known as DNSBLs (DNS based lists). By realtime it means that the list is always changing. An IP address or domain name could be on the list today and off the list tomorrow, so you could get different result depending on when you query the list.</p><p>You can use multiple blacklists to block spam. Go to <a href=https://www.debouncer.com>www.debouncer.com</a> and <a href=https://mxtoolbox.com>mxtoolbox.com</a>, enter the spammer’s domain and/or IP address to see which blacklists are blocking them, then you can use those blacklists. For example, I found that spammers are blacklisted by one of the following blacklists:</p><ul><li>dbl.spamhaus.org</li><li>zen.spamhaus.org</li><li>multi.uribl.com</li><li>ivmURI</li><li>InvaluementURI</li></ul><p>So I can add the following configurations in <code class=verbatim>/etc/postfix/main.cf</code> file. Some public blacklisting service requires monthly fee. For now, I’m using the free service of spamhaus.org:</p><div class="src src-text"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>smtpd_recipient_restrictions =
</span></span><span style=display:flex><span>   permit_mynetworks,
</span></span><span style=display:flex><span>   permit_sasl_authenticated,
</span></span><span style=display:flex><span>   check_policy_service unix:private/policyd-spf,
</span></span><span style=display:flex><span>   check_policy_service inet:127.0.0.1:10023,
</span></span><span style=display:flex><span>   check_client_access hash:/etc/postfix/rbl_override,
</span></span><span style=display:flex><span>   reject_rhsbl_helo dbl.spamhaus.org,
</span></span><span style=display:flex><span>   reject_rhsbl_reverse_client dbl.spamhaus.org,
</span></span><span style=display:flex><span>   reject_rhsbl_sender dbl.spamhaus.org,
</span></span><span style=display:flex><span>   reject_rbl_client zen.spamhaus.org</span></span></code></pre></div></div><ul><li><code class=verbatim>check_client_access</code>: File containing a list of domains you want to whitelist.</li><li><code class=verbatim>reject_rhsbl_helo</code>: Postfix reject email when the client HELO/EHLO hostname is blacklisted.</li><li><code class=verbatim>reject_rhsbl_reverse_client</code>: Checks the PTR (reverse DNS) record of the SMTP client’s IP address against Spamhaus's DBL. If the hostname is blacklisted, reject the email.</li><li><code class=verbatim>reject_rhsbl_sender</code> Postfix reject email when the domain in <code class=verbatim>MAIL FROM</code> header field is blacklisted.</li><li><code class=verbatim>reject_rbl_client</code>: This is an IP-based blacklist. When the client IP address is backlisted, reject the email.</li></ul><p><em>NOTE: Some spammers use Google’s mail server, so <code class=verbatim>reject_rhsbl_helo</code> is ineffective, but most of them use their own domain names in the <code class=verbatim>MAIL FROM</code> header field, so <code class=verbatim>reject_rhsbl_sender</code> will be effective.</em></p><p>Sometimes legitimate mail servers are blacklisted. In this case, we ask the Postfix server to whitelist these domains by listing them in a file:</p><div class="src src-shell"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>  sudo nano /etc/postfix/rbl_override</span></span></code></pre></div></div><p>Add the domains you want to whitelist:</p><div class="src src-text"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>dripemail2.com  OK           //This domain belongs to drip.com
</span></span><span style=display:flex><span>mlsend.com      OK           //This domain belongs to mailerlite email marketing service</span></span></code></pre></div></div><p>Then run the following command to create the <code class=verbatim>rbl_override.db</code> file.</p><div class="src src-shell"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>  sudo postmap /etc/postfix/rbl_override</span></span></code></pre></div></div><p>Reload Postfix for the changes to take effect.</p><div class="src src-shell"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>  sudo systemctl reload postfix</span></span></code></pre></div></div></div></div><div id=outline-container-headline-10 class=outline-2><h2 id=headline-10>Use Public Whitelist to Reduce False Positive</h2><div id=outline-text-headline-10 class=outline-text-2><p>Maintaining a private whitelist is necessary sometimes, but you can also use public whitelists, the most famous of which is <a href=https:dnswl.org>dnswl.org</a>. Currently, there is only a whitelist for IP address. Domain name whitelist is in beta. To use it, put the following line in <code class=verbatim>smtpd_recipient_restrictions</code>.</p><div class="src src-text"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>permit_dnswl_client list.dnswl.org=127.0.[0..255].[1..3],</span></span></code></pre></div></div><p>Like below. It should be placed above the reject_rbl_client check.</p><div class="src src-text"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>smtpd_recipient_restrictions =
</span></span><span style=display:flex><span>   permit_mynetworks,
</span></span><span style=display:flex><span>   permit_sasl_authenticated,
</span></span><span style=display:flex><span>   check_policy_service unix:private/policyd-spf,
</span></span><span style=display:flex><span>   check_policy_service inet:127.0.0.1:10023,
</span></span><span style=display:flex><span>   check_client_access hash:/etc/postfix/rbl_override,
</span></span><span style=display:flex><span>   reject_rhsbl_helo dbl.spamhaus.org,
</span></span><span style=display:flex><span>   reject_rhsbl_reverse_client dbl.spamhaus.org,
</span></span><span style=display:flex><span>   reject_rhsbl_sender dbl.spamhaus.org,
</span></span><span style=display:flex><span>   permit_dnswl_client list.dnswl.org=127.0.[0..255].[1..3],
</span></span><span style=display:flex><span>   reject_rbl_client zen.spamhaus.org</span></span></code></pre></div></div><p>Another well-known whitelist is <code class=verbatim>swl.spamhaus.org</code>, so you can also add it below the <code class=verbatim>permit_dnswl_client list.dnswl.org=127.0.[0..255].[1..3],</code> line:</p><div class="src src-text"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>permit_dnswl_client swl.spamhaus.org,</span></span></code></pre></div></div><p>It’s impossible for an IP address to be listed in Spamhaus whitelist and blacklist at the same time, so if you only use Spamhaus blacklist in Postfix, then it’s not necessary to check against Spamhaus whitelist.</p></div></div><div id=outline-container-headline-11 class=outline-2><h2 id=headline-11><span class=todo>TODO</span>
Anti-spam — SpamAssassin</h2><div id=outline-text-headline-11 class=outline-text-2><ul><li>State "TODO" from [2024-11-02 Sat 17:45]</li></ul><p>Run the following command to install SpamAssassin from the default Debian/Ubuntu software repository. Spamc is the client for SpamAssassin spam filtering daemon.</p><div class="src src-shell"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo apt install spamassassin spamc</span></span></code></pre></div></div></div></div></main><footer><hr>© <a href=https:www.atomicl.net>Vithurshan SELVARAJAH</a> 2022 – 2025 | <a href=https://github.com/BlackcatRs>Github</a> | <a href=https://www.linkedin.com/in/vithurshan-selvarajah/>LinkedIn</a></footer></body></html>