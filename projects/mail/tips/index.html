<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Tips/Tricks | Vithurshan SELVARAJAH</title><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/fonts/css/all.min.css><link rel=stylesheet href=/css/header-num.css><link rel=stylesheet href=/css/fonts.css></head><body><nav><ul class=menu><li><a href=/>Home</a></li><li><a href=/notes/>Notebook</a></li><li><a href=/categories/>Categories</a></li><li><a href=/projects/>Projects</a></li><li><a href=/index.xml>RSS</a></li></ul><hr></nav><div class=article-meta><h1><span class=title>Tips/Tricks</span></h1><div class=post-meta><span> Published on 16 Feb 2025</span>
<span class=seperator>.</span>
<span> Filed in <a href=/projects>Projects</a></span>
<span class=seperator>.</span>
<span> 470 words</span></div></div><main><div id=outline-container-headline-1 class=outline-2><h2 id=headline-1>How to Read Postfix Log ?</h2><div id=outline-text-headline-1 class=outline-text-2><p>Open a new terminal and read the log continuously:</p><div class="src src-shell"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>  sudo tail -f /var/log/mail.log</span></span></code></pre></div></div><p>While reading the log file, open a new terminal on the SMTP server and send a test mail:</p><div class="src src-shell"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>  swaks --to user1@example1.com --server localhost</span></span></code></pre></div></div><p>If all works as expected your <code class=verbatim>mail.log</code> will show a lot of technical information about the email delivery:</p><ul><li><code class=verbatim>postfix/smtpd[29225]: connect from localhost.localdomain[127.0.0.1]</code>
Postfix receives an incoming SMTP connection.</li><li><code class=verbatim>postfix/smtpd[29225]: *8BA46A0A3A*: client=localhost.localdomain[127.0.0.1]</code>
Postfix assigns a unique identifier (8BA46A0A3A) to this connection so that you see which log lines belong together. This is especially important with busy mail servers where multiple mails are handled in parallel.</li><li><code class=verbatim>postfix/cleanup[29233]: 8BA46A0A3A: message-id=20191126153053.029243@example1.com</code></li></ul><p>Swaks created a unique message id to the email which helps you identify specific mails in the log file.</p><ul><li><code class=verbatim>postfix/qmgr[13667]: 8BA46A0A3A: from=root@webmail.example.org, size=485, nrcpt=1 (queue active)</code>
The sender was <code class=verbatim>root@example.org</code>. This is logged after swaks sent the <code class=verbatim>MAIL FROM</code> line during the SMTP dialog.</li><li><code class=verbatim>postfix/smtpd[29225]: disconnect from localhost.localdomain[127.0.0.1] ehlo=1 mail=1 rcpt=1 data=1 quit=1 commands=5</code>
The SMTP communication ends. Postfix has now received and queued the email.</li><li><code class=verbatim>dovecot: lmtp(29237): Connect from local</code>
Postfix connects to Dovecot to hand over the email via the LMTP interface.</li><li><code class=verbatim>dovecot: lmtp(user1@example.com)&lt;29237>&lt;2PJTIh033V01cgAARGEcaw>: sieve: msgid=20191126153053.029243@example.org: stored mail into mailbox 'INBOX.test'</code>
Dovecot received the email and even evaluated User1’s sieve rule which made the email get stored to the <code class=verbatim>test</code> folder of his mailbox.</li><li><code class=verbatim>dovecot: lmtp(29237): Disconnect from local: Client has quit the connection (state=READY)</code>
The LMTP connection between Postfix and Dovecot is closed.</li><li><code class=verbatim>postfix/lmtp[29236]: 8BA46A0A3A: to=user1@example.com, relay=example.com[private/dovecot-lmtp], delay=0.01, delays=0/0/0/0.01, dsn=2.0.0, status=sent (250 2.0.0 user1@example1.com 2PJTIh033V01cgAARGEcaw Saved)</code>
This tells you what happened with a certain email. In this case it says that it was handed over to <code class=verbatim>dovecot-lmtp</code> and that the delivery was successful (<code class=verbatim>status=sent</code>). The status codes like <code class=verbatim>2.0.0</code> are defined in RFC 3463 and work similar to status codes in HTTP. Codes beginning with "2" are good. Those with "4" are temporary errors. And "5" stands for a permanent failure.</li></ul></div></div><div id=outline-container-headline-2 class=outline-2><h2 id=headline-2>Postfix Log Report</h2><div id=outline-text-headline-2 class=outline-text-2><p>Pflogsumm is a great tool to create a summary of Postfix logs. Install it:</p><div class="src src-shell"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>  sudo apt install pflogsumm</span></span></code></pre></div></div><p>Generate a report for this week:</p><div class="src src-shell"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>  sudo pflogsumm /var/log/mail.log</span></span></code></pre></div></div><table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody><tr><td><code>-d today</code></td><td>Generate a report for today</td></tr><tr><td><code>-d yesterday</code></td><td>Generate a report for yesterday</td></tr><tr><td><code>--problems-first</code></td><td>Add <code class=verbatim>problem</code> reports (bounces, defers, warnings, rejects) before <code class=verbatim>normal</code> stats use</td></tr><tr><td><code>--rej-add-from</code></td><td>Append the email from address to each listing in the reject report</td></tr><tr><td><code>--verbose-msg-detail</code></td><td>Show the full reason in reject summaries</td></tr></tbody></table><p>You can add a cron job to make pflogsumm to send a report to your email address every day:</p><div class="src src-shell"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>  sudo crontab -e</span></span></code></pre></div></div><p>Add the following line, which will generate a report every day at 4:00 am and send it to your email address:</p><div class="src src-text"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>0 4 * * * /usr/sbin/pflogsumm -d yesterday /var/log/mail.log --problems-first --rej-add-from --verbose-msg-detail -q MAILTO=&#34;your-email-address&#34;</span></span></code></pre></div></div><p><strong>CAREFUL: Make sure to replace <code class=verbatim>your-email-address</code> with your real email address</strong></p></div></div></main><footer><hr>© <a href=https:www.atomicl.net>Vithurshan SELVARAJAH</a> 2022 – 2025 | <a href=https://github.com/BlackcatRs>Github</a> | <a href=https://www.linkedin.com/in/vithurshan-selvarajah/>LinkedIn</a></footer></body></html>